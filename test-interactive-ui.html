<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Delivery Route - Validation (Demo)</title>
  <style>
    body { font-family: Arial; margin: 20px; background: #f5f5f5; }
    .container { max-width: 1400px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
    h1 { color: #2c3e50; text-align: center; margin-bottom: 10px; }
    .subtitle { text-align: center; color: #7f8c8d; margin-bottom: 30px; font-size: 14px; }
    .summary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; }
    .summary-item { text-align: center; }
    .summary-number { font-size: 32px; font-weight: bold; display: block; }
    .summary-label { font-size: 13px; opacity: 0.9; }
    .actions-bar { background: #34495e; color: white; padding: 15px; border-radius: 8px; margin-bottom: 20px; display: flex; gap: 10px; align-items: center; justify-content: space-between; flex-wrap: wrap; }
    .action-btn { padding: 12px 24px; border: none; border-radius: 5px; font-size: 14px; font-weight: bold; cursor: pointer; transition: all 0.3s; }
    .submit-btn { background: #27ae60; color: white; font-size: 16px; }
    .submit-btn:hover { background: #229954; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
    .select-all-btn, .deselect-all-btn { background: #3498db; color: white; }
    .select-all-btn:hover, .deselect-all-btn:hover { background: #2980b9; }
    .export-json-btn { background: #9b59b6; color: white; }
    .export-json-btn:hover { background: #8e44ad; }
    .validation-stats { color: white; font-size: 14px; }
    .group { margin-bottom: 25px; border: 2px solid #3498db; border-radius: 8px; overflow: hidden; }
    .group-header { background: #3498db; color: white; padding: 15px; font-size: 20px; font-weight: bold; display: flex; justify-content: space-between; align-items: center; }
    .group-stats { font-size: 14px; opacity: 0.9; }
    .street-section { padding: 15px; border-bottom: 1px solid #eee; }
    .street-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
    .street-name { font-weight: bold; color: #2c3e50; font-size: 16px; }
    .street-actions { display: flex; gap: 8px; }
    .street-btn { padding: 6px 12px; border: none; border-radius: 4px; font-size: 12px; cursor: pointer; background: #ecf0f1; color: #2c3e50; }
    .street-btn:hover { background: #bdc3c7; }
    .address-table { width: 100%; border-collapse: collapse; }
    .address-table th { background: #f8f9fa; padding: 10px; text-align: left; font-size: 13px; border-bottom: 2px solid #dee2e6; }
    .address-table td { padding: 10px; border-bottom: 1px solid #dee2e6; font-size: 13px; }
    .address-row { transition: background 0.2s; }
    .address-row:hover { background: #f8f9fa; }
    .address-row.invalid { opacity: 0.5; background: #fee; }
    .checkbox-cell { width: 40px; text-align: center; }
    .status-badge { display: inline-block; padding: 3px 8px; border-radius: 12px; font-size: 11px; font-weight: bold; }
    .status-rooftop { background: #d4edda; color: #155724; }
    .status-interpolated { background: #fff3cd; color: #856404; }
    .coordinates { color: #666; font-size: 11px; font-family: monospace; }
    .map-link { color: #3498db; text-decoration: none; font-size: 12px; }
    .map-link:hover { text-decoration: underline; }
    input[type="checkbox"] { width: 18px; height: 18px; cursor: pointer; }
    .toast { position: fixed; top: 20px; right: 20px; background: #27ae60; color: white; padding: 15px 20px; border-radius: 5px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); z-index: 1000; animation: slideIn 0.3s; }
    @keyframes slideIn { from { transform: translateX(400px); } to { transform: translateX(0); } }
  </style>
</head>
<body>
  <div class="container">
    <h1>üìç Delivery Route Address Validation</h1>
    <div class="subtitle">Review and validate geocoded addresses. Uncheck invalid addresses before submitting.</div>
    <div class="summary">
      <div class="summary-item"><span class="summary-number">1</span><span class="summary-label">Groups</span></div>
      <div class="summary-item"><span class="summary-number">8</span><span class="summary-label">Valid Addresses</span></div>
      <div class="summary-item"><span class="summary-number">7</span><span class="summary-label">‚úì Confirmed</span></div>
      <div class="summary-item"><span class="summary-number">1</span><span class="summary-label">‚ö† Verify</span></div>
      <div class="summary-item"><span class="summary-number">0</span><span class="summary-label">Not Found</span></div>
      <div class="summary-item"><span class="summary-number">0</span><span class="summary-label">Too Far</span></div>
    </div>
    <div class="actions-bar">
      <div style="display: flex; gap: 10px;">
        <button class="action-btn select-all-btn" onclick="selectAll()">‚úì Select All</button>
        <button class="action-btn deselect-all-btn" onclick="deselectAll()">‚úó Deselect All</button>
      </div>
      <div class="validation-stats">
        <span id="selectedCount">8</span> addresses selected
      </div>
      <div style="display: flex; gap: 10px;">
        <button class="action-btn export-json-btn" onclick="exportJSON()">üì• Export JSON</button>
        <button class="action-btn submit-btn" onclick="submitValidation()">‚úì Submit Validated Addresses</button>
      </div>
    </div>

    <div class="group" id="group-2">
      <div class="group-header">
        <span>Group 2 - 8 Houses</span>
        <div style="display: flex; gap: 10px; align-items: center;">
          <button class="action-btn" style="background: #e67e22; color: white; padding: 8px 16px; font-size: 14px;" onclick="generateRouteMap('group-2')">
            üó∫Ô∏è Generate Route Map
          </button>
          <span class="group-stats"><span id="group-2-selected">8</span> selected</span>
        </div>
      </div>
      <div class="street-section">
        <div class="street-header">
          <div class="street-name">üìç HILLCREST PT NW (5 houses)</div>
          <div class="street-actions">
            <button class="street-btn" onclick="selectStreet('street-1')">‚úì Select All</button>
            <button class="street-btn" onclick="deselectStreet('street-1')">‚úó Deselect All</button>
          </div>
        </div>
        <table class="address-table" id="street-1">
          <thead>
            <tr>
              <th class="checkbox-cell">‚úì</th>
              <th>House #</th>
              <th>Full Address</th>
              <th>Status</th>
              <th>Coordinates</th>
              <th>Map</th>
            </tr>
          </thead>
          <tbody>
            <tr class="address-row" data-group="2" data-street="HILLCREST PT NW">
              <td class="checkbox-cell"><input type="checkbox" checked onchange="updateCounts()" data-address='{"houseNumber":503,"streetName":"HILLCREST PT NW","fullAddress":"503 Hillcrest Point NW, Edmonton, AB, Canada","coordinates":{"lat":53.503773,"lng":-113.590761},"geocodeStatus":"rooftop"}'></td>
              <td><strong>503</strong></td>
              <td>503 Hillcrest Point NW, Edmonton, AB, Canada</td>
              <td><span class="status-badge status-rooftop">‚úì ROOFTOP</span></td>
              <td class="coordinates">53.503773, -113.590761</td>
              <td><a href="https://www.google.com/maps?q=53.503773,-113.590761" target="_blank" class="map-link">View Map</a></td>
            </tr>
            <tr class="address-row" data-group="2" data-street="HILLCREST PT NW">
              <td class="checkbox-cell"><input type="checkbox" checked onchange="updateCounts()" data-address='{"houseNumber":505,"streetName":"HILLCREST PT NW","fullAddress":"505 Hillcrest Point NW, Edmonton, AB, Canada","coordinates":{"lat":53.503914,"lng":-113.591492},"geocodeStatus":"interpolated"}'></td>
              <td><strong>505</strong></td>
              <td>505 Hillcrest Point NW, Edmonton, AB, Canada</td>
              <td><span class="status-badge status-interpolated">‚ö† INTERPOLATED</span></td>
              <td class="coordinates">53.503914, -113.591492</td>
              <td><a href="https://www.google.com/maps?q=53.503914,-113.591492" target="_blank" class="map-link">View Map</a></td>
            </tr>
            <tr class="address-row" data-group="2" data-street="HILLCREST PT NW">
              <td class="checkbox-cell"><input type="checkbox" checked onchange="updateCounts()" data-address='{"houseNumber":507,"streetName":"HILLCREST PT NW","fullAddress":"507 Hillcrest Point NW, Edmonton, AB, Canada","coordinates":{"lat":53.503939,"lng":-113.591549},"geocodeStatus":"rooftop"}'></td>
              <td><strong>507</strong></td>
              <td>507 Hillcrest Point NW, Edmonton, AB, Canada</td>
              <td><span class="status-badge status-rooftop">‚úì ROOFTOP</span></td>
              <td class="coordinates">53.503939, -113.591549</td>
              <td><a href="https://www.google.com/maps?q=53.503939,-113.591549" target="_blank" class="map-link">View Map</a></td>
            </tr>
            <tr class="address-row" data-group="2" data-street="HILLCREST PT NW">
              <td class="checkbox-cell"><input type="checkbox" checked onchange="updateCounts()" data-address='{"houseNumber":509,"streetName":"HILLCREST PT NW","fullAddress":"509 Hillcrest Point NW, Edmonton, AB, Canada","coordinates":{"lat":53.504083,"lng":-113.591871},"geocodeStatus":"rooftop"}'></td>
              <td><strong>509</strong></td>
              <td>509 Hillcrest Point NW, Edmonton, AB, Canada</td>
              <td><span class="status-badge status-rooftop">‚úì ROOFTOP</span></td>
              <td class="coordinates">53.504083, -113.591871</td>
              <td><a href="https://www.google.com/maps?q=53.504083,-113.591871" target="_blank" class="map-link">View Map</a></td>
            </tr>
            <tr class="address-row" data-group="2" data-street="HILLCREST PT NW">
              <td class="checkbox-cell"><input type="checkbox" checked onchange="updateCounts()" data-address='{"houseNumber":511,"streetName":"HILLCREST PT NW","fullAddress":"511 Hillcrest Point NW, Edmonton, AB, Canada","coordinates":{"lat":53.504213,"lng":-113.592128},"geocodeStatus":"rooftop"}'></td>
              <td><strong>511</strong></td>
              <td>511 Hillcrest Point NW, Edmonton, AB, Canada</td>
              <td><span class="status-badge status-rooftop">‚úì ROOFTOP</span></td>
              <td class="coordinates">53.504213, -113.592128</td>
              <td><a href="https://www.google.com/maps?q=53.504213,-113.592128" target="_blank" class="map-link">View Map</a></td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="street-section">
        <div class="street-header">
          <div class="street-name">üìç 156 ST NW (3 houses)</div>
          <div class="street-actions">
            <button class="street-btn" onclick="selectStreet('street-2')">‚úì Select All</button>
            <button class="street-btn" onclick="deselectStreet('street-2')">‚úó Deselect All</button>
          </div>
        </div>
        <table class="address-table" id="street-2">
          <thead>
            <tr>
              <th class="checkbox-cell">‚úì</th>
              <th>House #</th>
              <th>Full Address</th>
              <th>Status</th>
              <th>Coordinates</th>
              <th>Map</th>
            </tr>
          </thead>
          <tbody>
            <tr class="address-row" data-group="2" data-street="156 ST NW">
              <td class="checkbox-cell"><input type="checkbox" checked onchange="updateCounts()" data-address='{"houseNumber":7204,"streetName":"156 ST NW","fullAddress":"7204 156 Street NW, Edmonton, AB, Canada","coordinates":{"lat":53.504266,"lng":-113.590797},"geocodeStatus":"rooftop"}'></td>
              <td><strong>7204</strong></td>
              <td>7204 156 Street NW, Edmonton, AB, Canada</td>
              <td><span class="status-badge status-rooftop">‚úì ROOFTOP</span></td>
              <td class="coordinates">53.504266, -113.590797</td>
              <td><a href="https://www.google.com/maps?q=53.504266,-113.590797" target="_blank" class="map-link">View Map</a></td>
            </tr>
            <tr class="address-row" data-group="2" data-street="156 ST NW">
              <td class="checkbox-cell"><input type="checkbox" checked onchange="updateCounts()" data-address='{"houseNumber":7208,"streetName":"156 ST NW","fullAddress":"7208 156 Street NW, Edmonton, AB, Canada","coordinates":{"lat":53.504418,"lng":-113.590799},"geocodeStatus":"rooftop"}'></td>
              <td><strong>7208</strong></td>
              <td>7208 156 Street NW, Edmonton, AB, Canada</td>
              <td><span class="status-badge status-rooftop">‚úì ROOFTOP</span></td>
              <td class="coordinates">53.504418, -113.590799</td>
              <td><a href="https://www.google.com/maps?q=53.504418,-113.590799" target="_blank" class="map-link">View Map</a></td>
            </tr>
            <tr class="address-row" data-group="2" data-street="156 ST NW">
              <td class="checkbox-cell"><input type="checkbox" checked onchange="updateCounts()" data-address='{"houseNumber":7212,"streetName":"156 ST NW","fullAddress":"7212 156 Street NW, Edmonton, AB, Canada","coordinates":{"lat":53.504564,"lng":-113.590836},"geocodeStatus":"rooftop"}'></td>
              <td><strong>7212</strong></td>
              <td>7212 156 Street NW, Edmonton, AB, Canada</td>
              <td><span class="status-badge status-rooftop">‚úì ROOFTOP</span></td>
              <td class="coordinates">53.504564, -113.590836</td>
              <td><a href="https://www.google.com/maps?q=53.504564,-113.590836" target="_blank" class="map-link">View Map</a></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    function updateCounts() {
      const allCheckboxes = document.querySelectorAll('input[type="checkbox"]');
      const checkedCount = Array.from(allCheckboxes).filter(cb => cb.checked).length;
      document.getElementById('selectedCount').textContent = checkedCount;
      
      document.querySelectorAll('.group').forEach(group => {
        const groupId = group.id;
        const groupCheckboxes = group.querySelectorAll('input[type="checkbox"]');
        const groupChecked = Array.from(groupCheckboxes).filter(cb => cb.checked).length;
        const countElement = document.getElementById(groupId + '-selected');
        if (countElement) countElement.textContent = groupChecked;
      });
      
      allCheckboxes.forEach(cb => {
        const row = cb.closest('tr');
        if (row) {
          if (cb.checked) {
            row.classList.remove('invalid');
          } else {
            row.classList.add('invalid');
          }
        }
      });
    }

    function selectAll() {
      document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = true);
      updateCounts();
    }

    function deselectAll() {
      document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
      updateCounts();
    }

    function selectStreet(streetId) {
      document.querySelectorAll('#' + streetId + ' input[type="checkbox"]').forEach(cb => cb.checked = true);
      updateCounts();
    }

    function deselectStreet(streetId) {
      document.querySelectorAll('#' + streetId + ' input[type="checkbox"]').forEach(cb => cb.checked = false);
      updateCounts();
    }

    function exportJSON() {
      const validatedData = getValidatedData();
      const json = JSON.stringify(validatedData, null, 2);
      const blob = new Blob([json], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'validated-addresses-' + new Date().toISOString().split('T')[0] + '.json';
      a.click();
      showToast('JSON exported successfully!');
    }

    function getValidatedData() {
      const groups = {};
      
      document.querySelectorAll('input[type="checkbox"]:checked').forEach(cb => {
        const address = JSON.parse(cb.dataset.address);
        const row = cb.closest('tr');
        const groupNum = row.dataset.group;
        const streetName = row.dataset.street;
        
        if (!groups[groupNum]) {
          groups[groupNum] = { groupNumber: parseInt(groupNum), streets: {}, totalHouses: 0 };
        }
        
        if (!groups[groupNum].streets[streetName]) {
          groups[groupNum].streets[streetName] = { streetName: streetName, addresses: [] };
        }
        
        groups[groupNum].streets[streetName].addresses.push(address);
        groups[groupNum].totalHouses++;
      });
      
      const groupsArray = Object.values(groups).map(g => ({
        ...g,
        streets: Object.values(g.streets)
      }));
      
      return {
        groups: groupsArray,
        summary: {
          totalGroups: groupsArray.length,
          totalValidatedAddresses: Object.values(groups).reduce((sum, g) => sum + g.totalHouses, 0),
          validatedAt: new Date().toISOString()
        }
      };
    }

    function submitValidation() {
      const validatedData = getValidatedData();
      const totalSelected = validatedData.summary.totalValidatedAddresses;
      
      if (totalSelected === 0) {
        alert('‚ö†Ô∏è No addresses selected! Please select at least one address.');
        return;
      }
      
      if (confirm(`Submit ${totalSelected} validated addresses?\n\nThis will finalize the address list.`)) {
        console.log('Validated Data:', validatedData);
        showToast(`‚úì ${totalSelected} addresses validated successfully!`);
        exportJSON();
      }
    }

    function showToast(message) {
      const toast = document.createElement('div');
      toast.className = 'toast';
      toast.textContent = message;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    function generateRouteMap(groupId) {
      // Get all checked addresses in this group
      const group = document.getElementById(groupId);
      const checkedCheckboxes = group.querySelectorAll('input[type="checkbox"]:checked');
      
      if (checkedCheckboxes.length === 0) {
        alert('‚ö†Ô∏è No addresses selected in this group! Please select at least one address.');
        return;
      }
      
      // Collect all addresses with coordinates
      const addresses = [];
      checkedCheckboxes.forEach(cb => {
        const address = JSON.parse(cb.dataset.address);
        if (address.coordinates && address.coordinates.lat && address.coordinates.lng) {
          addresses.push(address);
        }
      });
      
      if (addresses.length === 0) {
        alert('‚ö†Ô∏è No valid coordinates found for selected addresses!');
        return;
      }
      
      // Build Google Maps URL with optimized route
      if (addresses.length === 1) {
        // Single address - just open the location
        const addr = addresses[0];
        const url = `https://www.google.com/maps?q=${addr.coordinates.lat},${addr.coordinates.lng}`;
        window.open(url, '_blank');
        showToast('Opening single address location...');
      } else {
        // Multiple addresses - create route
        const origin = addresses[0];
        const destination = addresses[addresses.length - 1];
        const waypoints = addresses.slice(1, -1).map(a => `${a.coordinates.lat},${a.coordinates.lng}`).join('|');
        
        let url = `https://www.google.com/maps/dir/?api=1&origin=${origin.coordinates.lat},${origin.coordinates.lng}&destination=${destination.coordinates.lat},${destination.coordinates.lng}`;
        
        if (waypoints) {
          url += `&waypoints=${waypoints}`;
        }
        
        // Add travelmode (walking for delivery)
        url += '&travelmode=walking';
        
        window.open(url, '_blank');
        showToast(`Opening route with ${addresses.length} stops...`);
      }
    }

    updateCounts();
  </script>
</body>
</html>
